!function(){class e{constructor(e){this.x=e.x??0,this.y=e.y??0}static getRandomVector(t){return new e({x:Math.random()*(t?.x||1),y:Math.random()*(t?.y||1)})}add(e){return this.x+=e.x,this.y+=e.y,this}minus(e){return this.x-=e.x,this.y-=e.y,this}multByScalar(e){return this.x*=e,this.y*=e,this}lenght(){return Math.sqrt(this.x**2+this.y**2)}normalize(){const e=this.lenght();return this.x/=e,this.y/=e,this}distanceTo(e){return Math.sqrt((this.x-e.x)**2+(this.y-e.y)**2)}}const t=new e({x:800,y:400}),i=10,s=7.5,n=15;class a{alive=!0;constructor(t,i,s){this.position=new e(t),this.speed=new e(i),this.size=s??0}intersect(t){if(!this.alive||!t.alive)return!1;const i=this.size/2+t.size/2;return new e(this.position).minus(t.position).lenght()<i}die(){this.alive=!1}}class o extends a{constructor(e,t,i){super(e,t,4),this.speed.normalize().multByScalar(4),this.deathTimestamp=i+1500}move(){this.position.add(this.speed)}isAlive(e){return this.alive&&this.deathTimestamp>e}}class r extends a{lives=3;fire_delay=2500;last_fire_timestamp=0;constructor(e,t){super(e,t,15)}move(i,n){const a=new e(this.position);a.add(this.speed),(a.x-s<=0||a.x+s>=t.x)&&(this.speed.x*=-1),(a.y-s<=0||a.y+s>=t.y)&&(this.speed.y*=-1),this.position.add(this.speed)}decreaseLife(e=1){this.lives-=e,this.lives<=0&&this.die()}fire(t,i){if(0===this.last_fire_timestamp)this.last_fire_timestamp=i;else if(i-this.last_fire_timestamp>this.fire_delay){this.last_fire_timestamp=i;const s=new e(t).minus(this.position);return[new o(this.position,s,i)]}return[]}}class l extends r{move(t,i){if(!i)throw"Target needed !";const s=new e(i.position);s.minus(this.position),this.speed=s.normalize(),super.move(t,i)}}class h extends r{}function p(){const e=Array.from(navigator.getGamepads());return e?.sort?.(((e,t)=>(e?.timestamp??0)<(t?.timestamp??0)?1:-1)),e?e[0]:null}function c(e,t){const i=p();i&&i.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:t,weakMagnitude:e,strongMagnitude:e})}class m extends a{fire_delay=250;last_fire_timestamp=0;lives=3;is_invincible=!1;invincible_until_timestamp=0;constructor(){super({x:250,y:250},{},20)}move(e){this.speed=e.positionInput.multByScalar(2),this.position.add(this.speed),this.position.x<=i?this.position.x=i:this.position.x+i>=t.x&&(this.position.x=t.x-i),this.position.y<=i?this.position.y=i:this.position.y+i>=t.y&&(this.position.y=t.y-i)}fire(e,t){return e.fireInput.lenght()>.2&&t-this.last_fire_timestamp>this.fire_delay?(this.last_fire_timestamp=t,[new o(this.position,e.fireInput,t)]):[]}decreaseLife(e){if(!this.is_invincible){if(c(.5,500),this.lives--,this.lives<=0)return c(.8,1e3),this.die();this.is_invincible=!0,this.invincible_until_timestamp=e+1e3}}checkInvincibility(e){this.is_invincible&&e>=this.invincible_until_timestamp&&(this.is_invincible=!1)}}class d{enemies=[];nextSpawnTimestamp=0;allies_projectiles=[];enemies_projectiles=[];constructor(){this.player=new m}reset(){this.player=new m,this.enemies=[],this.allies_projectiles=[],this.enemies_projectiles=[],this.nextSpawnTimestamp=0}schedule(e,t){if(this.player.alive){this.player.checkInvincibility(e),this.player.move(t),this.allies_projectiles.push(...this.player.fire(t,e));for(const e of this.allies_projectiles){e.move();for(const t of this.enemies)t.intersect(e)&&(t.decreaseLife(),e.die())}this.enemies=this.enemies.filter((e=>e.alive));for(const i of this.enemies)i.move(t,this.player),i.intersect(this.player)&&this.player.decreaseLife(e),this.enemies_projectiles.push(...i.fire(this.player.position,e));for(const t of this.enemies_projectiles)t.move(),t.intersect(this.player)&&(this.player.decreaseLife(e),t.die());this.allies_projectiles=this.allies_projectiles.filter((t=>t.isAlive(e))),this.enemies_projectiles=this.enemies_projectiles.filter((t=>t.isAlive(e))),(e>this.nextSpawnTimestamp||0==this.enemies.length)&&(this.enemies.push(this.spawnRandomEnemy()),this.nextSpawnTimestamp=e+4e3)}}spawnRandomEnemy(){let i=e.getRandomVector(t);for(;i.distanceTo(this.player.position)<20;)i=e.getRandomVector(t);return Math.random()<.5?new h(i,e.getRandomVector().multByScalar(1.5)):new l(i,e.getRandomVector().multByScalar(1.5))}}class u{constructor(e){this.canvas=e}displayMessage(e){const t=this.canvas.getContext("2d");t&&(t.fillStyle="black",t.font="48px serif",t.fillText(e,10,50))}draw(e){const i=this.canvas.getContext("2d");i&&(i.clearRect(0,0,t.x,t.y),this.drawBG(i),this.drawPlayer(e,i),this.drawEnemies(e,i),this.drawAlliesProjectiles(e,i),this.drawEnemyProjectiles(e,i),this.drawLifes(e,i))}drawBG(e){e.fillStyle="rgba(200,200,200,.8)",e.fillRect(0,0,t.x,t.y)}drawPlayer(e,t){const{position:s,speed:n}=e.player;t.strokeStyle="red",t.fillStyle=e.player.is_invincible?"red":"orange",t.fillRect(s.x-i,s.y-i,20,20)}drawEnemies(e,t){t.strokeStyle="green";for(const i of e.enemies)i instanceof h?t.strokeRect(i.position.x-s,i.position.y-s,15,15):i instanceof l&&(t.beginPath(),t.arc(i.position.x,i.position.y,s,0,2*Math.PI,!1),t.stroke())}drawAlliesProjectiles(t,i){i.strokeStyle="brown";for(const s of t.allies_projectiles){i.beginPath(),i.moveTo(s.position.x,s.position.y);const t=new e(s.position);t.add(s.speed),i.lineTo(t.x,t.y),i.stroke()}}drawEnemyProjectiles(t,i){i.strokeStyle="red";for(const s of t.enemies_projectiles){i.beginPath(),i.moveTo(s.position.x,s.position.y);const t=new e(s.position);t.add(s.speed),i.lineTo(t.x,t.y),i.stroke()}}drawLifes(e,t){t.strokeStyle="black",t.fillStyle="red";for(let i=0;i<3;i++)t.beginPath(),t.moveTo(i*n+10,10),t.lineTo(i*n+8,9),t.lineTo(i*n+5,4),t.lineTo(i*n+6,3),t.lineTo(i*n+9,3),t.lineTo(i*n+10,5),t.lineTo(i*n+11,3),t.lineTo(i*n+14,3),t.lineTo(i*n+15,4),t.lineTo(i*n+12,9),t.closePath(),e.player.lives>i?t.fill():t.stroke()}}class y{pause=!0;lastPauseTimeStamp=0;lastResetTimeStamp=0;tmpTimeStamp=0;timeSpentInPause=0;realGameTime=0;displayedMessageForPause="Waiting for gamePad...";constructor(e){const i=document.getElementById(e);if(!i)throw new Error("Cant find canvas with id "+e);i.style.width=t.x+"px",i.style.height=t.y+"px",i.setAttribute("width",t.x.toString()),i.setAttribute("height",t.y.toString()),this.game=new d,this.drawer=new u(i),window.addEventListener("gamepadconnected",(e=>{this.pause=!1,this.displayedMessageForPause="Pause !"}))}checkSpecialInputs(e,t=0){e.buttons.L1&&e.buttons.R1&&t-this.lastResetTimeStamp>1e3&&(this.game.reset(),this.lastResetTimeStamp=t),e.buttons.Pause&&t-this.lastPauseTimeStamp>1e3&&(this.pause=!this.pause,this.lastPauseTimeStamp=t)}correctTimeStamps(e=0){const t=e-this.tmpTimeStamp;this.tmpTimeStamp=e,this.pause?this.timeSpentInPause+=t:this.realGameTime+=t}loop=t=>{this.correctTimeStamps(t);const i=function(){const t=p(),i={L1:t?.buttons?.[4]?.pressed??!1,R1:t?.buttons?.[5]?.pressed??!1,Pause:t?.buttons?.[9]?.pressed??!1};return{positionInput:new e({x:t?.axes?.[0]??0,y:t?.axes?.[1]??0}),fireInput:new e({x:t?.axes?.[2]??0,y:t?.axes?.[3]??0}),buttons:i}}();this.checkSpecialInputs(i,t),this.pause||this.game.schedule(this.realGameTime,i),this.drawer.draw(this.game),this.pause&&this.drawer.displayMessage(this.displayedMessageForPause),requestAnimationFrame(this.loop)}}document.addEventListener("DOMContentLoaded",(function(){new y("main").loop()}))}();
//# sourceMappingURL=index.a22e20bf.js.map
